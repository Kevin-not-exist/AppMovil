<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Movil</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/functions.js"></script>
</head>

<body>
    <ons-navigator id="nav" page="t_login"></ons-navigator>
    <template id="t_infolocal">
        <ons-page>
            <script>
                ons.getScriptPage().onShow =  function(){
                    //tomar el parámetro que me envian desde click .listado_locales.
                    const id_local = this.data.id;
                    url = `http://api.marcelocaiafa.com/local?id=${id_local}`;
                    $.ajax({
                        url: url,
                        type: "GET",
                        dataType: "json",
                        success: function(local){
                            let item = "";
                                item = `
                                <ons-card>
                                    <img src="http://images.marcelocaiafa.com/local/${id_local}.jpg" alt="Onsen UI" style="width: 100%">
                                    <div class="title">
                                        <h3>${local.nombre}</h3>
                                    </div>
                                    <div class="content">
                                        <p>${local.telefono}</p>
                                        <p>${local.descripcion}</p>
                                    </div>
                                </ons-card>`
                                $("#l_local").append(item);
                        }
                    });
                }
            </script>
                <ons-list id="l_local"></ons-list>
            <section>

            </section>
        </ons-page>
    </template>

    <template id="t_listado">
        <ons-page id="p_listado">
            <script>
                ons.getScriptPage().onInit = function () {
                    //se ejecuta cuando se crea la pagina (única vez). 
                    //eventos javascript por ejemplo on click.
                    
                    $(document).on("click", ".listado_locales", function(){
                        const id = $(this).data("id");
                        //request a API con este id para obtener todos los datos del local.
                        //const url = `http://api.marcelocaiafa.com/local/${id}`;
                        //alert(url);
                        nav.pushPage("t_infolocal", {data:{
                            id:id
                        }});
                    });
                }
                ons.getScriptPage().onShow = function () {

                    //cada vez que entro a esta pagina.
                    //por ejemplo invocar api con listado de locales.

                    let usuario = sessionStorage.getItem("usuario");
                    usuario = JSON.parse(usuario);
                    $("#saludo").html(`Hola <strong> ${usuario.nombre} </strong>`);
                    const url = "http://api.marcelocaiafa.com/local";
                    $.ajax({
                        url: url,
                        type: "GET",
                        dataType: "json",
                        success: function (locales) {
                            let item = "";
                            $.each(locales.descripcion, function(key, local){
                                item = `<ons-list-item modifier = "chevron longdivider" class="listado_locales" data-id = '${local.id}'  tappable tap-background-color="#3ED47A">
                                        <div class="left">
                                            <img class="list-item__thumbnail" src="http://images.marcelocaiafa.com/local/${local.imagen}">
                                        </div>
                                        <div class="center">
                                            <span class="list-item__title">${local.nombre}</span><span class="list-item__subtitle">${local.telefono}</span>
                                        </div>
                                        </ons-list-item>`;
                                $("#l_lista").append(item);
                            });
                        },
                        error: function (xml_request, err, status) {
                            ons.notification.toast(xml_request.responseJSON.descripcion, {
                                "timeout": 3000
                            });
                        }
                    });
                }
            </script>
            <section>
                <h1>Listado de locales</h1>
                <p id="saludo"></p>
                <ons-list id="l_lista"></ons-list>
            </section>
        </ons-page>
    </template>

    <template id="t_login">
        <ons-page id="p_login">
            <section>
                <h1>Login de usuario</h1>
                <label for="email_login">Email</label>
                <p><input type="text" class="text-input text-input--material" id="email_login" placeholder="Ingrese email"></p>
                <label for="pwd_login">Contrase&ntilde;a</label>
                <p><input type="password" class="text-input text-input--material" id="pwd_login" placeholder="Ingrese contraseña"></p>
                <p>
                    <ons-select id="tipo_login">
                        <option value="">Seleccione una opción</option>
                        <option value="U">Usuario</option>
                        <option value="M">Médico</option>
                    </ons-select>
                </p>
                <p>
                    <ons-button id="btn_no_registrado">¿No estas registrado?</ons-button>
                </p>
                <p>
                    <ons-button id="btn_login">Login</ons-button>
                </p>
            </section>
        </ons-page>
    </template>


    <template id="t_registro">
        <ons-page id="p_registro">
            <section>
                <h1>Registro de usuario</h1>
                <label for="nombre">Nombre</label>
                <p><input type="text" class="text-input text-input--material" id="nombre" placeholder="Ingrese nombre" value="Kevin">
                </p>
                <label for="apellido">Apellido</label>
                <p><input type="text" class="text-input text-input--material" id="apellido" placeholder="Ingrese apellido" value="Devotto"></p>
                <label for="email">Email</label>
                <p><input type="text" class="text-input text-input--material" id="email" placeholder="Ingrese email">
                </p>
                <label for="pwd">Contrase&ntilde;a</label>
                <p><input type="password" class="text-input text-input--material" id="pwd" placeholder="Ingrese contraseña" value="753"></p>
                <label for="repwd">Re contrase&ntilde;a</label>
                <p><input type="password" class="text-input text-input--material" id="repwd" placeholder="Repita la contraseña" value="753"></p>
                <label for="telefono">Teléfono</label>
                <p><input type="text" class="text-input text-input--material" id="telefono" placeholder="Teléfono" value="099112233"></p>
                <label for="documento">Documento</label>
                <p><input type="text" class="text-input text-input--material" id="documento" placeholder="De 7 a 8 digitos..."></p>
                <p>
                    <ons-select id="genero">
                        <option value="">Seleccione una opci&oacute;n</option>
                        <option value="M">Masc</option>
                        <option value="F">Fem</option>
                    </ons-select>
                </p>
                <p>
                    <ons-button id="btn_registro">Registrarse</ons-button>
                </p>
            </section>
        </ons-page>
    </template>

   <!--Navegación Usuario-->
   <template id="t_navegacion_usuario">
    <ons-page id="p_navegacion_usuario">
        <ons-toolbar>
            <div class="center">
              <ons-segment id="segment" tabbar-id="tabbar" style="width: 100%">
                <button>Page 1</button>
                <button>Page 2</button>
                <button>Page 3</button>
              </ons-segment>
            </div>
          </ons-toolbar>
        <ons-tabbar id="tabbar">
            <ons-tab page="t_info_medico" active></ons-tab>
            <ons-tab page="t_medico_favorito"></ons-tab>
            <ons-tab page="t_reserva_medica"></ons-tab>
          </ons-tabbar>
    </ons-page>
   </template>

    <!-- Información de profesionales médicos -->
    <template id="t_info_medico">
        <ons-page id="p_prueba">
            <section>
                <h1>Información de profesionales médicos</h1>
            </section>
        </ons-page>
    </template>

    <!-- Reserva médica -->
    <template id="t_reserva_medica">
        <ons-page id="p_reserva_medica">
            <section>
                <h1>Reserva médica</h1>
            </section>
        </ons-page>
    </template>

    <!-- Médicos favoritos -->
    <template id="t_medico_favorito">
        <ons-page id="p_medico_favorito">
            <section>
                <h1>Médicos favoritos</h1>
            </section>
        </ons-page>
    </template>

    <!--Navegación Médico-->
   <template id="t_navegacion_medico">
    <ons-page id="p_navegacion_medico">
        <ons-toolbar>
            <div class="center">
              <ons-segment id="segment" tabbar-id="tabbar_medico" style="width: 100%">
                <button>Page 1</button>
                <button>Page 2</button>
              </ons-segment>
            </div>
          </ons-toolbar>
        <ons-tabbar id="tabbar_medico">
            <ons-tab page="t_historial_consulta_medica" active></ons-tab>
            <ons-tab page="t_nota_consulta_medica"></ons-tab>
          </ons-tabbar>
    </ons-page>
   </template>

    <!--Historial de consultas médicas-->
    <template id="t_historial_consulta_medica">
        <ons-page id="p_historial_consulta_medica">

        </ons-page>
    </template>

    <!--Nota consulta médica-->
    <template id="t_nota_consulta_medica">
        <ons-page id="p_nota_consulta_medica">

        </ons-page>
    </template>
</body>

</html>